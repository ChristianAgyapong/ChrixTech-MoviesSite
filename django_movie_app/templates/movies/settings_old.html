{% extends 'base.html' %}

{% block title %}Settings - Cinema Chronicles{% endblock %}

{% block extra_css %}
<style>
.settings-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem;
}

.settings-header {
    text-align: center;
    margin-bottom: 3rem;
}

.settings-header h1 {
    color: var(--primary-color);
    margin-bottom: 0.5rem;
    font-size: 2.5rem;
}

.settings-subtitle {
    color: var(--text-muted);
    font-size: 1.1rem;
}

.settings-section {
    background: var(--gradient-card);
    padding: 2rem;
    margin-bottom: 2rem;
    border-radius: 1rem;
    border: 1px solid var(--border-color);
    box-shadow: 0 4px 20px var(--shadow-light);
    backdrop-filter: blur(10px);
}

.section-header {
    margin-bottom: 1.5rem;
    border-bottom: 2px solid var(--primary-color);
    padding-bottom: 1rem;
}

.section-header h3 {
    color: var(--primary-color);
    margin-bottom: 0.5rem;
    font-size: 1.4rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.section-header p {
    color: var(--text-muted);
    margin: 0;
}

.settings-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.checkbox-group {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.form-check {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    padding: 1rem;
    background: rgba(255, 75, 110, 0.05);
    border-radius: 0.5rem;
    border: 1px solid rgba(255, 75, 110, 0.1);
    transition: all 0.3s ease;
}

.form-check:hover {
    background: rgba(255, 75, 110, 0.1);
    border-color: rgba(255, 75, 110, 0.2);
    transform: translateY(-2px);
}

.form-check-input {
    margin-top: 0.2rem;
    accent-color: var(--primary-color);
}

.form-check-label {
    font-weight: 600;
    color: var(--text-secondary);
    cursor: pointer;
    flex: 1;
}

.form-help {
    display: block;
    color: var(--text-muted);
    font-size: 0.85rem;
    margin-top: 0.25rem;
}

.genres-group {
    grid-column: 1 / -1;
}

.genres-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
}

.genre-option {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.8rem;
    background: var(--bg-tertiary);
    border-radius: 0.5rem;
    border: 1px solid var(--border-color);
    transition: all 0.3s ease;
    cursor: pointer;
}

.genre-option:hover {
    background: var(--bg-secondary);
    border-color: var(--primary-color);
    transform: translateY(-1px);
}

.genre-option input[type="checkbox"] {
    accent-color: var(--primary-color);
}

.settings-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    padding: 2rem 0;
    flex-wrap: wrap;
}

.btn-outline {
    background: transparent;
    color: var(--primary-color);
    border: 2px solid var(--primary-color);
}

.btn-outline:hover {
    background: var(--primary-color);
    color: white;
}

.btn-reset {
    background: transparent;
    color: var(--error-color);
    border: 2px solid var(--error-color);
}

.btn-reset:hover {
    background: var(--error-color);
    color: white;
}

.theme-preview {
    margin-top: 1rem;
    padding: 1rem;
    background: var(--bg-tertiary);
    border-radius: 0.5rem;
    border: 1px solid var(--border-color);
    text-align: center;
    font-size: 0.9rem;
    color: var(--text-muted);
}

.setting-value-display {
    font-size: 0.9rem;
    color: var(--primary-color);
    margin-top: 0.25rem;
    font-weight: 600;
}

@media (max-width: 768px) {
    .settings-container {
        padding: 1rem;
    }
    
    .settings-grid {
        grid-template-columns: 1fr;
    }
    
    .settings-actions {
        flex-direction: column;
    }
    
    .genres-grid {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="container settings-container">
    <div class="settings-header">
        <h1><i class="fas fa-cog"></i> Settings & Preferences</h1>
        <p class="settings-subtitle">Customize your Cinema Chronicles experience</p>
    </div>

    {% if messages %}
        {% for message in messages %}
            <div class="message message-{{ message.tags }}">
                <i class="fas fa-check-circle"></i> {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <form method="post" class="settings-form">
        {% csrf_token %}
        
        <!-- Display Preferences -->
        <div class="settings-section">
            <div class="section-header">
                <h3><i class="fas fa-desktop"></i> Display Preferences</h3>
                <p>Customize how movies are displayed</p>
            </div>
            <div class="settings-grid">
                <div class="form-group">
                    <label for="{{ form.theme.id_for_label }}">Theme</label>
                    {{ form.theme }}
                    <div class="theme-preview">
                        Select your preferred theme
                    </div>
                </div>
                <div class="form-group">
                    <label for="{{ form.default_view.id_for_label }}">Default View</label>
                    {{ form.default_view }}
                </div>
                <div class="form-group">
                    <label for="{{ form.movies_per_page.id_for_label }}">Movies Per Page</label>
                    {{ form.movies_per_page }}
                </div>
            </div>
        </div>

        <!-- Filter Preferences -->
        <div class="settings-section">
            <div class="section-header">
                <h3><i class="fas fa-filter"></i> Filter Preferences</h3>
                <p>Set your default movie filters</p>
            </div>
            <div class="settings-grid">
                <div class="form-group">
                    <label for="{{ form.min_rating.id_for_label }}">Minimum Rating</label>
                    {{ form.min_rating }}
                    <small class="form-help">{{ form.min_rating.help_text }}</small>
                </div>
                <div class="form-group">
                    <label for="{{ form.max_rating.id_for_label }}">Maximum Rating</label>
                    {{ form.max_rating }}
                    <small class="form-help">{{ form.max_rating.help_text }}</small>
                </div>
                <div class="form-group">
                    <label for="{{ form.min_release_year.id_for_label }}">Earliest Year</label>
                    {{ form.min_release_year }}
                    <small class="form-help">{{ form.min_release_year.help_text }}</small>
                </div>
                <div class="form-group">
                    <label for="{{ form.max_release_year.id_for_label }}">Latest Year</label>
                    {{ form.max_release_year }}
                    <small class="form-help">{{ form.max_release_year.help_text }}</small>
                </div>
            </div>
            
            <div class="form-group genres-group">
                <label>Preferred Genres</label>
                <div class="genres-grid">
                    {% for choice in form.preferred_genres.field.widget.choices %}
                        <div class="form-check">
                            <input type="checkbox" 
                                   name="preferred_genres" 
                                   value="{{ choice.0 }}" 
                                   id="id_preferred_genres_{{ forloop.counter0 }}"
                                   class="form-check-input"
                                   {% if choice.0 in form.preferred_genres.value|default:'' %}checked{% endif %}>
                            <label class="form-check-label" for="id_preferred_genres_{{ forloop.counter0 }}">
                                {{ choice.1 }}
                            </label>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Content Preferences -->
        <div class="settings-section">
            <div class="section-header">
                <h3><i class="fas fa-language"></i> Content Preferences</h3>
                <p>Set your content and language preferences</p>
            </div>
            <div class="settings-grid">
                <div class="form-group">
                    <label for="{{ form.preferred_language.id_for_label }}">Preferred Language</label>
                    {{ form.preferred_language }}
                </div>
                <div class="form-group">
                    <label for="{{ form.max_content_rating.id_for_label }}">Maximum Content Rating</label>
                    {{ form.max_content_rating }}
                </div>
            </div>
        </div>

        <!-- Privacy Settings -->
        <div class="settings-section">
            <div class="section-header">
                <h3><i class="fas fa-shield-alt"></i> Privacy Settings</h3>
                <p>Control your privacy and visibility</p>
            </div>
            <div class="checkbox-group">
                <div class="form-check">
                    {{ form.public_watch_history }}
                    <label for="{{ form.public_watch_history.id_for_label }}" class="form-check-label">
                        Make Watch History Public
                    </label>
                    <small class="form-help">{{ form.public_watch_history.help_text }}</small>
                </div>
                <div class="form-check">
                    {{ form.public_favorites }}
                    <label for="{{ form.public_favorites.id_for_label }}" class="form-check-label">
                        Make Favorites Public
                    </label>
                    <small class="form-help">{{ form.public_favorites.help_text }}</small>
                </div>
                <div class="form-check">
                    {{ form.public_profile }}
                    <label for="{{ form.public_profile.id_for_label }}" class="form-check-label">
                        Public Profile
                    </label>
                    <small class="form-help">{{ form.public_profile.help_text }}</small>
                </div>
            </div>
        </div>

        <!-- Notification Settings -->
        <div class="settings-section">
            <div class="section-header">
                <h3><i class="fas fa-bell"></i> Notification Settings</h3>
                <p>Choose what notifications you want to receive</p>
            </div>
            <div class="checkbox-group">
                <div class="form-check">
                    {{ form.email_notifications }}
                    <label for="{{ form.email_notifications.id_for_label }}" class="form-check-label">
                        Email Notifications
                    </label>
                    <small class="form-help">{{ form.email_notifications.help_text }}</small>
                </div>
                <div class="form-check">
                    {{ form.new_releases_notifications }}
                    <label for="{{ form.new_releases_notifications.id_for_label }}" class="form-check-label">
                        New Releases
                    </label>
                    <small class="form-help">{{ form.new_releases_notifications.help_text }}</small>
                </div>
                <div class="form-check">
                    {{ form.recommendation_notifications }}
                    <label for="{{ form.recommendation_notifications.id_for_label }}" class="form-check-label">
                        Movie Recommendations
                    </label>
                    <small class="form-help">{{ form.recommendation_notifications.help_text }}</small>
                </div>
                <div class="form-check">
                    {{ form.weekly_summary }}
                    <label for="{{ form.weekly_summary.id_for_label }}" class="form-check-label">
                        Weekly Summary
                    </label>
                    <small class="form-help">{{ form.weekly_summary.help_text }}</small>
                </div>
            </div>
        </div>

        <!-- Advanced Settings -->
        <div class="settings-section">
            <div class="section-header">
                <h3><i class="fas fa-cogs"></i> Advanced Settings</h3>
                <p>Advanced options for power users</p>
            </div>
            <div class="checkbox-group">
                <div class="form-check">
                    {{ form.auto_add_to_history }}
                    <label for="{{ form.auto_add_to_history.id_for_label }}" class="form-check-label">
                        Auto-add to Watch History
                    </label>
                    <small class="form-help">{{ form.auto_add_to_history.help_text }}</small>
                </div>
                <div class="form-check">
                    {{ form.show_adult_content }}
                    <label for="{{ form.show_adult_content.id_for_label }}" class="form-check-label">
                        Show Adult Content
                    </label>
                    <small class="form-help">{{ form.show_adult_content.help_text }}</small>
                </div>
                <div class="form-check">
                    {{ form.data_saver_mode }}
                    <label for="{{ form.data_saver_mode.id_for_label }}" class="form-check-label">
                        Data Saver Mode
                    </label>
                    <small class="form-help">{{ form.data_saver_mode.help_text }}</small>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="settings-actions">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> Save Settings
            </button>
            <a href="{% url 'movies:export_data' %}" class="btn btn-secondary">
                <i class="fas fa-download"></i> Export My Data
            </a>
            <button type="button" class="btn btn-reset" onclick="settingsManager.resetToDefaults()">
                <i class="fas fa-undo"></i> Reset to Defaults
            </button>
            <a href="{% url 'movies:home' %}" class="btn btn-outline">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
            </a>
        </div>
    </form>
</div>

<!-- Load Settings JavaScript -->
{% load static %}
<script src="{% static 'js/settings.js' %}"></script>

<script>
// Additional settings functionality
document.addEventListener('DOMContentLoaded', function() {
    // Live preview for theme changes
    const themeSelect = document.getElementById('id_theme');
    if (themeSelect) {
        const updateThemePreview = () => {
            const selectedTheme = themeSelect.value;
            const preview = document.querySelector('.theme-preview');
            if (preview) {
                let previewText = '';
                switch(selectedTheme) {
                    case 'dark':
                        previewText = 'Dark theme provides a comfortable viewing experience in low light conditions.';
                        break;
                    case 'light':
                        previewText = 'Light theme offers better readability in bright environments.';
                        break;
                    case 'auto':
                        previewText = 'Auto theme automatically adapts to your system preference.';
                        break;
                }
                preview.textContent = previewText;
            }
        };
        
        updateThemePreview();
        themeSelect.addEventListener('change', updateThemePreview);
    }

    // Live display of rating ranges
    const minRating = document.getElementById('id_min_rating');
    const maxRating = document.getElementById('id_max_rating');
    
    if (minRating && maxRating) {
        const updateRatingDisplay = () => {
            const min = minRating.value;
            const max = maxRating.value;
            
            let display = document.querySelector('#rating-display');
            if (!display) {
                display = document.createElement('div');
                display.id = 'rating-display';
                display.className = 'setting-value-display';
                maxRating.parentNode.appendChild(display);
            }
            
            display.textContent = `Showing movies rated ${min} - ${max} stars`;
        };
        
        minRating.addEventListener('input', updateRatingDisplay);
        maxRating.addEventListener('input', updateRatingDisplay);
        updateRatingDisplay();
    }

    // Live display of year ranges
    const minYear = document.getElementById('id_min_release_year');
    const maxYear = document.getElementById('id_max_release_year');
    
    if (minYear && maxYear) {
        const updateYearDisplay = () => {
            const min = minYear.value;
            const max = maxYear.value;
            
            let display = document.querySelector('#year-display');
            if (!display) {
                display = document.createElement('div');
                display.id = 'year-display';
                display.className = 'setting-value-display';
                maxYear.parentNode.appendChild(display);
            }
            
            display.textContent = `Showing movies from ${min} - ${max}`;
        };
        
        minYear.addEventListener('input', updateYearDisplay);
        maxYear.addEventListener('input', updateYearDisplay);
        updateYearDisplay();
    }

    // Genre selection counter
    const updateGenreCount = () => {
        const selected = document.querySelectorAll('input[name="preferred_genres"]:checked').length;
        let counter = document.querySelector('#genre-counter');
        
        if (!counter) {
            counter = document.createElement('div');
            counter.id = 'genre-counter';
            counter.className = 'setting-value-display';
            document.querySelector('.genres-group label').appendChild(counter);
        }
        
        counter.textContent = selected > 0 ? ` (${selected} selected)` : ' (All genres)';
    };
    
    document.querySelectorAll('input[name="preferred_genres"]').forEach(checkbox => {
        checkbox.addEventListener('change', updateGenreCount);
    });
    updateGenreCount();
});
</script>

<style>
.settings-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem;
}

.settings-header {
    text-align: center;
    margin-bottom: 3rem;
}

.settings-header h1 {
    color: #ff4b6e;
    margin-bottom: 0.5rem;
}

.settings-subtitle {
    color: #888;
    font-size: 1.1rem;
}

.settings-section {
    background: linear-gradient(145deg, #23232b 0%, #2a2a32 100%);
    padding: 2rem;
    margin-bottom: 2rem;
    border-radius: 1rem;
    border: 1px solid #3a3a3a;
}

.section-header {
    margin-bottom: 1.5rem;
    border-bottom: 2px solid #ff4b6e;
    padding-bottom: 1rem;
}

.section-header h3 {
    color: #ff4b6e;
    margin-bottom: 0.5rem;
}

.section-header p {
    color: #888;
    margin: 0;
}

.settings-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.checkbox-group {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.form-check {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    padding: 1rem;
    background: rgba(255, 75, 110, 0.05);
    border-radius: 0.5rem;
    border: 1px solid rgba(255, 75, 110, 0.1);
}

.form-check-input {
    margin-top: 0.2rem;
}

.form-check-label {
    font-weight: 600;
    color: #e0e0e0;
    cursor: pointer;
    flex: 1;
}

.form-help {
    display: block;
    color: #888;
    font-size: 0.85rem;
    margin-top: 0.25rem;
}

.genres-group {
    grid-column: 1 / -1;
}

.genres-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
}

.genres-grid .form-check {
    background: rgba(255, 75, 110, 0.05);
    border: 1px solid rgba(255, 75, 110, 0.1);
    border-radius: 0.5rem;
    padding: 0.75rem;
    margin: 0;
}

.genres-grid .form-check:hover {
    background: rgba(255, 75, 110, 0.1);
    border-color: rgba(255, 75, 110, 0.3);
}

.genres-grid input[type="checkbox"] {
    margin-right: 0.5rem;
}

.genres-grid input[type="checkbox"]:checked + label {
    color: #ff4b6e;
    font-weight: 600;
}

.settings-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    padding: 2rem 0;
    flex-wrap: wrap;
}

.btn-outline {
    background: transparent;
    color: #ff4b6e;
    border: 2px solid #ff4b6e;
}

.btn-outline:hover {
    background: #ff4b6e;
    color: white;
}

@media (max-width: 768px) {
    .settings-container {
        padding: 1rem;
    }
    
    .settings-grid {
        grid-template-columns: 1fr;
    }
    
    .settings-actions {
        flex-direction: column;
    }
}
</style>
{% endblock %}
